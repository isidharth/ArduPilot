<html>
<body>
<style>
  #byte_content {
    margin: 5px 0;
    max-height: 100px;
    overflow-y: auto;
    overflow-x: hidden;
  }
  canvas{
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
  }
</style>
<input type="file" id="files" name="file" />
<script type="text/javascript" src="DF_Reader.js"></script>
<script type="text/javascript" src="chart.js"></script>
<script type="text/javascript" src="utils.js"></script>
<span class="readBytesButtons">
  <button>Parse Log</button>
</span>
<div style="width:75%;">
    <canvas id="canvas"></canvas>
</div>
<script>
        var config = {
        type: 'line',
        data: {
            labels:label_plot,
            datasets: [{
                label: "ACCx",
                backgroundColor: window.chartColors.red,
                borderColor: window.chartColors.red,
                data:x_plot,
                fill: false,
            }, {
                label: "ACCy",
                fill: false,
                backgroundColor: window.chartColors.blue,
                borderColor: window.chartColors.blue,
                data:y_plot,
            },{
                label: "ACCz",
                fill: false,
                backgroundColor: window.chartColors.green,
                borderColor: window.chartColors.green,
                data:z_plot,
            }]
        },
        options: {
            responsive: true,
            title:{
                display:true,
                text:'arduPilot graphing system'
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'time'
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'acc'
                    }
                }]
            }
        }
    };

  function readBlob(opt_startByte, opt_stopByte) {

    var files = document.getElementById('files').files;
    if (!files.length) {
      alert('Please select a file!');
      return;
    }
    var file = files[0];
    var start = 0;
    var stop = file.size - 1;

    var reader = new FileReader();

    // If we use onloadend, we need to check the readyState.
    reader.onloadend = function(evt) {

      if (evt.target.readyState == FileReader.DONE) {
        buffer=evt.target.result;
        data=new DataView(buffer);
        DF_reader();
        parse_atOffset(174);
        var ctx = document.getElementById("canvas").getContext("2d");
        window.myLine = new Chart(ctx, config);
      }
    };

    var blob = file.slice(start, stop + 1);
    reader.readAsArrayBuffer(blob);
}

  document.querySelector('.readBytesButtons').addEventListener('click', function(evt) {
    if (evt.target.tagName.toLowerCase() == 'button') {
      var startByte = evt.target.getAttribute('data-startbyte');
      var endByte = evt.target.getAttribute('data-endbyte');
      readBlob(startByte, endByte);

    }
  }, false);
</script>
</body>
</html>
